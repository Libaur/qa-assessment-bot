"use strict";var e=require("fs"),t=require("path"),i=require("os"),r=require("crypto");const s=new Map;function n(e){const t=Array.isArray(e)?e:[e],i=t.join(","),r=s.get(i)??(()=>{const e=function(e){const t=e.flatMap((e=>function(e,t){if(0===t.length)throw new Error("Empty filter query given");const i=t.map(c).filter((e=>!0!==e));if(0===i.length)return t;throw 1===i.length?new Error(i[0]):new Error(`Invalid filter query '${e.join(":")}'. There are ${i.length} errors after expanding the contained shortcuts: ${i.join("; ")}`)}(e,a(e)))),i=function(e){const t=Object.entries(e).map((([e,t])=>{const i=t=>t[e],r=Object.entries(t).map((([e,t])=>{const i=t=>t[e],r=Array.from(t).map((e=>"me"===e?(e,t)=>{const i=t.me.id;return l(e,(e=>e.id===i))}:t=>l(t,(t=>t[e]||t.type===e))));return 0===r.length?d(i):u(i,r.reduce(h))}));return 0===r.length?d(i):u(i,r.reduce(h))}));if(0===t.length)throw new Error("Cannot create filter function for empty query");return t.reduce(h)}(function(e){const t={};for(const[i,r,s]of e){const e=t[i]??={};if(void 0!==r){const t=e[r]??=new Set;void 0!==s&&t.add(s)}}return t}(t));return e=>!!i(e.update,e)}(o(t));return s.set(i,e),e})();return e=>r(e)}function o(e){return Array.isArray(e)?e.map((e=>e.split(":"))):[e.split(":")]}function a(e){const t=w,i=[e].flatMap((e=>{const[i,r,s]=e;if(!(i in b))return[e];if(!i&&!r&&!s)return[e];const n=b[i].map((e=>[e,r,s]));return void 0===r||r in v&&(r||s)?n:n.filter((([e])=>!!t[e]?.[r]))})).flatMap((e=>{const[i,r,s]=e;if(!(r in v))return[e];if(!r&&!s)return[e];const n=v[r].map((e=>[i,e,s]));return void 0===s?n:n.filter((([,e])=>!!t[i]?.[e]?.[s]))}));if(0===i.length)throw new Error(`Shortcuts in '${e.join(":")}' do not expand to any valid filter query`);return i}function c(e){const[t,i,r,...s]=e;if(void 0===t)return"Empty filter query given";if(!(t in w)){const i=Object.keys(w);return`Invalid L1 filter '${t}' given in '${e.join(":")}'. Permitted values are: ${i.map((e=>`'${e}'`)).join(", ")}.`}if(void 0===i)return!0;const n=w[t];if(!(i in n)){const t=Object.keys(n);return`Invalid L2 filter '${i}' given in '${e.join(":")}'. Permitted values are: ${t.map((e=>`'${e}'`)).join(", ")}.`}if(void 0===r)return!0;const o=n[i];if(!(r in o)){const s=Object.keys(o);return`Invalid L3 filter '${r}' given in '${e.join(":")}'. ${0===s.length?`No further filtering is possible after '${t}:${i}'.`:`Permitted values are: ${s.map((e=>`'${e}'`)).join(", ")}.`}`}return 0===s.length||`Cannot filter further than three levels, ':${s.join(":")}' is invalid!`}function h(e,t){return(i,r)=>e(i,r)||t(i,r)}function u(e,t){return(i,r)=>{const s=e(i,r);return s&&t(s,r)}}function d(e){return(t,i)=>null!=e(t,i)}function l(e,t){const i=e=>null!=e&&t(e);return Array.isArray(e)?e.some(i):i(e)}const p={mention:{},hashtag:{},cashtag:{},bot_command:{},url:{},email:{},phone_number:{},bold:{},italic:{},underline:{},strikethrough:{},spoiler:{},blockquote:{},expandable_blockquote:{},code:{},pre:{},text_link:{},text_mention:{},custom_emoji:{}},m={me:{},is_bot:{},is_premium:{},added_to_attachment_menu:{}},g={emoji:{},custom_emoji:{},paid:{}},f={forward_origin:{user:{},hidden_user:{},chat:{},channel:{}},is_topic_message:{},is_automatic_forward:{},business_connection_id:{},text:{},animation:{},audio:{},document:{},paid_media:{},photo:{},sticker:{is_video:{},is_animated:{},premium_animation:{}},story:{},video:{},video_note:{},voice:{},contact:{},dice:{},game:{},poll:{},venue:{},location:{},entities:p,caption_entities:p,caption:{},effect_id:{},has_media_spoiler:{},new_chat_title:{},new_chat_photo:{},delete_chat_photo:{},message_auto_delete_timer_changed:{},pinned_message:{},invoice:{},proximity_alert_triggered:{},chat_background_set:{},giveaway_created:{},giveaway:{only_new_members:{},has_public_winners:{}},giveaway_winners:{only_new_members:{},was_refunded:{}},giveaway_completed:{},video_chat_scheduled:{},video_chat_started:{},video_chat_ended:{},video_chat_participants_invited:{},web_app_data:{}},_={...f,new_chat_members:m,left_chat_member:m,group_chat_created:{},supergroup_chat_created:{},migrate_to_chat_id:{},migrate_from_chat_id:{},successful_payment:{},refunded_payment:{},users_shared:{},chat_shared:{},connected_website:{},write_access_allowed:{},passport_data:{},boost_added:{},forum_topic_created:{},forum_topic_edited:{name:{},icon_custom_emoji_id:{}},forum_topic_closed:{},forum_topic_reopened:{},general_forum_topic_hidden:{},general_forum_topic_unhidden:{},sender_boost_count:{}},y={...f,channel_chat_created:{}},C={from:m},w={message:_,edited_message:_,channel_post:y,edited_channel_post:y,business_connection:{can_reply:{},is_enabled:{}},business_message:_,edited_business_message:_,deleted_business_messages:{},inline_query:{},chosen_inline_result:{},callback_query:{data:{},game_short_name:{}},shipping_query:{},pre_checkout_query:{},poll:{},poll_answer:{},my_chat_member:C,chat_member:C,chat_join_request:{},message_reaction:{old_reaction:g,new_reaction:g},message_reaction_count:{reactions:g},chat_boost:{},removed_chat_boost:{},purchased_paid_media:{}},b={"":["message","channel_post"],msg:["message","channel_post"],edit:["edited_message","edited_channel_post"]},v={"":["entities","caption_entities"],media:["photo","video"],file:["photo","animation","audio","document","video","video_note","voice","sticker"]},k={filterQuery(e){const t=n(e);return e=>t(e)},text(e){const t=k.filterQuery([":text",":caption"]),i=T(e);return e=>{if(!t(e))return!1;const r=e.message??e.channelPost;return x(e,r.text??r.caption,i)}},command(e){const t=k.filterQuery(":entities:bot_command"),i=new Set,r=new Set;return S(e).forEach((e=>{if(e.startsWith("/"))throw new Error(`Do not include '/' when registering command handlers (use '${e.substring(1)}' not '${e}')`);(e.includes("@")?i:r).add(e)})),e=>{if(!t(e))return!1;const s=e.message??e.channelPost,n=s.text??s.caption;return s.entities.some((t=>{if("bot_command"!==t.type)return!1;if(0!==t.offset)return!1;const s=n.substring(1,t.length);if(r.has(s)||i.has(s))return e.match=n.substring(s.length+1).trimStart(),!0;const o=s.indexOf("@");if(-1===o)return!1;if(s.substring(o+1).toLowerCase()!==e.me.username.toLowerCase())return!1;const a=s.substring(0,o);return!!r.has(a)&&(e.match=n.substring(s.length+1).trimStart(),!0)}))}},reaction(e){const t=k.filterQuery("message_reaction"),i="string"==typeof e?[{type:"emoji",emoji:e}]:(Array.isArray(e)?e:[e]).map((e=>"string"==typeof e?{type:"emoji",emoji:e}:e)),r=new Set(i.filter((e=>"emoji"===e.type)).map((e=>e.emoji))),s=new Set(i.filter((e=>"custom_emoji"===e.type)).map((e=>e.custom_emoji_id))),n=i.some((e=>"paid"===e.type));return e=>{if(!t(e))return!1;const{old_reaction:i,new_reaction:o}=e.messageReaction;for(const e of o){let t=!1;if("emoji"===e.type){for(const r of i)if("emoji"===r.type&&r.emoji===e.emoji){t=!0;break}}else if("custom_emoji"===e.type){for(const r of i)if("custom_emoji"===r.type&&r.custom_emoji_id===e.custom_emoji_id){t=!0;break}}else if("paid"===e.type)for(const e of i)if("paid"===e.type){t=!0;break}if(!t)if("emoji"===e.type){if(r.has(e.emoji))return!0}else if("custom_emoji"===e.type){if(s.has(e.custom_emoji_id))return!0}else{if("paid"!==e.type)return!0;if(n)return!0}}return!1}},chatType(e){const t=new Set(S(e));return e=>void 0!==e.chat?.type&&t.has(e.chat.type)},callbackQuery(e){const t=k.filterQuery("callback_query:data"),i=T(e);return e=>t(e)&&x(e,e.callbackQuery.data,i)},gameQuery(e){const t=k.filterQuery("callback_query:game_short_name"),i=T(e);return e=>t(e)&&x(e,e.callbackQuery.game_short_name,i)},inlineQuery(e){const t=k.filterQuery("inline_query"),i=T(e);return e=>t(e)&&x(e,e.inlineQuery.query,i)},chosenInlineResult(e){const t=k.filterQuery("chosen_inline_result"),i=T(e);return e=>t(e)&&x(e,e.chosenInlineResult.result_id,i)},preCheckoutQuery(e){const t=k.filterQuery("pre_checkout_query"),i=T(e);return e=>t(e)&&x(e,e.preCheckoutQuery.invoice_payload,i)},shippingQuery(e){const t=k.filterQuery("shipping_query"),i=T(e);return e=>t(e)&&x(e,e.shippingQuery.invoice_payload,i)}};class I{update;api;me;match;constructor(e,t,i){this.update=e,this.api=t,this.me=i}get message(){return this.update.message}get editedMessage(){return this.update.edited_message}get channelPost(){return this.update.channel_post}get editedChannelPost(){return this.update.edited_channel_post}get businessConnection(){return this.update.business_connection}get businessMessage(){return this.update.business_message}get editedBusinessMessage(){return this.update.edited_business_message}get deletedBusinessMessages(){return this.update.deleted_business_messages}get messageReaction(){return this.update.message_reaction}get messageReactionCount(){return this.update.message_reaction_count}get inlineQuery(){return this.update.inline_query}get chosenInlineResult(){return this.update.chosen_inline_result}get callbackQuery(){return this.update.callback_query}get shippingQuery(){return this.update.shipping_query}get preCheckoutQuery(){return this.update.pre_checkout_query}get poll(){return this.update.poll}get pollAnswer(){return this.update.poll_answer}get myChatMember(){return this.update.my_chat_member}get chatMember(){return this.update.chat_member}get chatJoinRequest(){return this.update.chat_join_request}get chatBoost(){return this.update.chat_boost}get removedChatBoost(){return this.update.removed_chat_boost}get purchasedPaidMedia(){return this.update.purchased_paid_media}get msg(){return this.message??this.editedMessage??this.channelPost??this.editedChannelPost??this.businessMessage??this.editedBusinessMessage??this.callbackQuery?.message}get chat(){return(this.msg??this.deletedBusinessMessages??this.messageReaction??this.messageReactionCount??this.myChatMember??this.chatMember??this.chatJoinRequest??this.chatBoost??this.removedChatBoost)?.chat}get senderChat(){return this.msg?.sender_chat}get from(){return(this.businessConnection??this.messageReaction??(this.chatBoost?.boost??this.removedChatBoost)?.source)?.user??(this.callbackQuery??this.msg??this.inlineQuery??this.chosenInlineResult??this.shippingQuery??this.preCheckoutQuery??this.myChatMember??this.chatMember??this.chatJoinRequest??this.purchasedPaidMedia)?.from}get msgId(){return this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id}get chatId(){return this.chat?.id??this.businessConnection?.user_chat_id}get inlineMessageId(){return this.callbackQuery?.inline_message_id??this.chosenInlineResult?.inline_message_id}get businessConnectionId(){return this.msg?.business_connection_id??this.businessConnection?.id??this.deletedBusinessMessages?.business_connection_id}entities(e){const t=this.msg;if(void 0===t)return[];const i=t.text??t.caption;if(void 0===i)return[];let r=t.entities??t.caption_entities;if(void 0===r)return[];if(void 0!==e){const t=new Set(S(e));r=r.filter((e=>t.has(e.type)))}return r.map((e=>({...e,text:i.substring(e.offset,e.offset+e.length)})))}reactions(){const e=[],t=[],i=[],r=[],s=[],n=[],o=[],a=[];let c=!1,h=!1;const u=this.messageReaction;if(void 0!==u){const{old_reaction:d,new_reaction:l}=u;for(const t of l)"emoji"===t.type?e.push(t.emoji):"custom_emoji"===t.type?s.push(t.custom_emoji_id):"paid"===t.type&&(c=h=!0);for(const e of d)"emoji"===e.type?r.push(e.emoji):"custom_emoji"===e.type?a.push(e.custom_emoji_id):"paid"===e.type&&(h=!1);t.push(...e),n.push(...s);for(let e=0;e<r.length;e++){const s=t.length;if(0===s)break;const n=r[e];for(let o=0;o<s;o++)if(n===t[o]){i.push(n),r.splice(e,1),t.splice(o,1),e--;break}}for(let e=0;e<a.length;e++){const t=n.length;if(0===t)break;const i=a[e];for(let r=0;r<t;r++)if(i===n[r]){o.push(i),a.splice(e,1),n.splice(r,1),e--;break}}}return{emoji:e,emojiAdded:t,emojiKept:i,emojiRemoved:r,customEmoji:s,customEmojiAdded:n,customEmojiKept:o,customEmojiRemoved:a,paid:c,paidAdded:h}}static has=k;has(e){return I.has.filterQuery(e)(this)}hasText(e){return I.has.text(e)(this)}hasCommand(e){return I.has.command(e)(this)}hasReaction(e){return I.has.reaction(e)(this)}hasChatType(e){return I.has.chatType(e)(this)}hasCallbackQuery(e){return I.has.callbackQuery(e)(this)}hasGameQuery(e){return I.has.gameQuery(e)(this)}hasInlineQuery(e){return I.has.inlineQuery(e)(this)}hasChosenInlineResult(e){return I.has.chosenInlineResult(e)(this)}hasPreCheckoutQuery(e){return I.has.preCheckoutQuery(e)(this)}hasShippingQuery(e){return I.has.shippingQuery(e)(this)}reply(e,t,i){return this.api.sendMessage(M(this.chatId,"sendMessage"),e,{business_connection_id:this.businessConnectionId,...t},i)}forwardMessage(e,t,i){return this.api.forwardMessage(e,M(this.chatId,"forwardMessage"),M(this.msgId,"forwardMessage"),t,i)}forwardMessages(e,t,i,r){return this.api.forwardMessages(e,M(this.chatId,"forwardMessages"),t,i,r)}copyMessage(e,t,i){return this.api.copyMessage(e,M(this.chatId,"copyMessage"),M(this.msgId,"copyMessage"),t,i)}copyMessages(e,t,i,r){return this.api.copyMessages(e,M(this.chatId,"copyMessages"),t,i,r)}replyWithPhoto(e,t,i){return this.api.sendPhoto(M(this.chatId,"sendPhoto"),e,{business_connection_id:this.businessConnectionId,...t},i)}replyWithAudio(e,t,i){return this.api.sendAudio(M(this.chatId,"sendAudio"),e,{business_connection_id:this.businessConnectionId,...t},i)}replyWithDocument(e,t,i){return this.api.sendDocument(M(this.chatId,"sendDocument"),e,{business_connection_id:this.businessConnectionId,...t},i)}replyWithVideo(e,t,i){return this.api.sendVideo(M(this.chatId,"sendVideo"),e,{business_connection_id:this.businessConnectionId,...t},i)}replyWithAnimation(e,t,i){return this.api.sendAnimation(M(this.chatId,"sendAnimation"),e,{business_connection_id:this.businessConnectionId,...t},i)}replyWithVoice(e,t,i){return this.api.sendVoice(M(this.chatId,"sendVoice"),e,{business_connection_id:this.businessConnectionId,...t},i)}replyWithVideoNote(e,t,i){return this.api.sendVideoNote(M(this.chatId,"sendVideoNote"),e,{business_connection_id:this.businessConnectionId,...t},i)}replyWithMediaGroup(e,t,i){return this.api.sendMediaGroup(M(this.chatId,"sendMediaGroup"),e,{business_connection_id:this.businessConnectionId,...t},i)}replyWithLocation(e,t,i,r){return this.api.sendLocation(M(this.chatId,"sendLocation"),e,t,{business_connection_id:this.businessConnectionId,...i},r)}editMessageLiveLocation(e,t,i,r){const s=this.inlineMessageId;return void 0!==s?this.api.editMessageLiveLocationInline(s,e,t,i):this.api.editMessageLiveLocation(M(this.chatId,"editMessageLiveLocation"),M(this.msgId,"editMessageLiveLocation"),e,t,i,r)}stopMessageLiveLocation(e,t){const i=this.inlineMessageId;return void 0!==i?this.api.stopMessageLiveLocationInline(i,e):this.api.stopMessageLiveLocation(M(this.chatId,"stopMessageLiveLocation"),M(this.msgId,"stopMessageLiveLocation"),e,t)}sendPaidMedia(e,t,i,r){return this.api.sendPaidMedia(M(this.chatId,"sendPaidMedia"),e,t,i,r)}replyWithVenue(e,t,i,r,s,n){return this.api.sendVenue(M(this.chatId,"sendVenue"),e,t,i,r,{business_connection_id:this.businessConnectionId,...s},n)}replyWithContact(e,t,i,r){return this.api.sendContact(M(this.chatId,"sendContact"),e,t,{business_connection_id:this.businessConnectionId,...i},r)}replyWithPoll(e,t,i,r){return this.api.sendPoll(M(this.chatId,"sendPoll"),e,t,{business_connection_id:this.businessConnectionId,...i},r)}replyWithDice(e,t,i){return this.api.sendDice(M(this.chatId,"sendDice"),e,{business_connection_id:this.businessConnectionId,...t},i)}replyWithChatAction(e,t,i){return this.api.sendChatAction(M(this.chatId,"sendChatAction"),e,{business_connection_id:this.businessConnectionId,...t},i)}react(e,t,i){return this.api.setMessageReaction(M(this.chatId,"setMessageReaction"),M(this.msgId,"setMessageReaction"),"string"==typeof e?[{type:"emoji",emoji:e}]:(Array.isArray(e)?e:[e]).map((e=>"string"==typeof e?{type:"emoji",emoji:e}:e)),t,i)}getUserProfilePhotos(e,t){return this.api.getUserProfilePhotos(M(this.from,"getUserProfilePhotos").id,e,t)}getUserChatBoosts(e,t){return this.api.getUserChatBoosts(e,M(this.from,"getUserChatBoosts").id,t)}getBusinessConnection(e){return this.api.getBusinessConnection(M(this.businessConnectionId,"getBusinessConnection"),e)}getFile(e){const t=M(this.msg,"getFile"),i=void 0!==t.photo?t.photo[t.photo.length-1]:t.animation??t.audio??t.document??t.video??t.video_note??t.voice??t.sticker;return this.api.getFile(M(i,"getFile").file_id,e)}kickAuthor(...e){return this.banAuthor(...e)}banAuthor(e,t){return this.api.banChatMember(M(this.chatId,"banAuthor"),M(this.from,"banAuthor").id,e,t)}kickChatMember(...e){return this.banChatMember(...e)}banChatMember(e,t,i){return this.api.banChatMember(M(this.chatId,"banChatMember"),e,t,i)}unbanChatMember(e,t,i){return this.api.unbanChatMember(M(this.chatId,"unbanChatMember"),e,t,i)}restrictAuthor(e,t,i){return this.api.restrictChatMember(M(this.chatId,"restrictAuthor"),M(this.from,"restrictAuthor").id,e,t,i)}restrictChatMember(e,t,i,r){return this.api.restrictChatMember(M(this.chatId,"restrictChatMember"),e,t,i,r)}promoteAuthor(e,t){return this.api.promoteChatMember(M(this.chatId,"promoteAuthor"),M(this.from,"promoteAuthor").id,e,t)}promoteChatMember(e,t,i){return this.api.promoteChatMember(M(this.chatId,"promoteChatMember"),e,t,i)}setChatAdministratorAuthorCustomTitle(e,t){return this.api.setChatAdministratorCustomTitle(M(this.chatId,"setChatAdministratorAuthorCustomTitle"),M(this.from,"setChatAdministratorAuthorCustomTitle").id,e,t)}setChatAdministratorCustomTitle(e,t,i){return this.api.setChatAdministratorCustomTitle(M(this.chatId,"setChatAdministratorCustomTitle"),e,t,i)}banChatSenderChat(e,t){return this.api.banChatSenderChat(M(this.chatId,"banChatSenderChat"),e,t)}unbanChatSenderChat(e,t){return this.api.unbanChatSenderChat(M(this.chatId,"unbanChatSenderChat"),e,t)}setChatPermissions(e,t,i){return this.api.setChatPermissions(M(this.chatId,"setChatPermissions"),e,t,i)}exportChatInviteLink(e){return this.api.exportChatInviteLink(M(this.chatId,"exportChatInviteLink"),e)}createChatInviteLink(e,t){return this.api.createChatInviteLink(M(this.chatId,"createChatInviteLink"),e,t)}editChatInviteLink(e,t,i){return this.api.editChatInviteLink(M(this.chatId,"editChatInviteLink"),e,t,i)}createChatSubscriptionInviteLink(e,t,i,r){return this.api.createChatSubscriptionInviteLink(M(this.chatId,"createChatSubscriptionInviteLink"),e,t,i,r)}editChatSubscriptionInviteLink(e,t,i){return this.api.editChatSubscriptionInviteLink(M(this.chatId,"editChatSubscriptionInviteLink"),e,t,i)}revokeChatInviteLink(e,t){return this.api.revokeChatInviteLink(M(this.chatId,"editChatInviteLink"),e,t)}approveChatJoinRequest(e,t){return this.api.approveChatJoinRequest(M(this.chatId,"approveChatJoinRequest"),e,t)}declineChatJoinRequest(e,t){return this.api.declineChatJoinRequest(M(this.chatId,"declineChatJoinRequest"),e,t)}setChatPhoto(e,t){return this.api.setChatPhoto(M(this.chatId,"setChatPhoto"),e,t)}deleteChatPhoto(e){return this.api.deleteChatPhoto(M(this.chatId,"deleteChatPhoto"),e)}setChatTitle(e,t){return this.api.setChatTitle(M(this.chatId,"setChatTitle"),e,t)}setChatDescription(e,t){return this.api.setChatDescription(M(this.chatId,"setChatDescription"),e,t)}pinChatMessage(e,t,i){return this.api.pinChatMessage(M(this.chatId,"pinChatMessage"),e,t,i)}unpinChatMessage(e,t){return this.api.unpinChatMessage(M(this.chatId,"unpinChatMessage"),e,t)}unpinAllChatMessages(e){return this.api.unpinAllChatMessages(M(this.chatId,"unpinAllChatMessages"),e)}leaveChat(e){return this.api.leaveChat(M(this.chatId,"leaveChat"),e)}getChat(e){return this.api.getChat(M(this.chatId,"getChat"),e)}getChatAdministrators(e){return this.api.getChatAdministrators(M(this.chatId,"getChatAdministrators"),e)}getChatMembersCount(...e){return this.getChatMemberCount(...e)}getChatMemberCount(e){return this.api.getChatMemberCount(M(this.chatId,"getChatMemberCount"),e)}getAuthor(e){return this.api.getChatMember(M(this.chatId,"getAuthor"),M(this.from,"getAuthor").id,e)}getChatMember(e,t){return this.api.getChatMember(M(this.chatId,"getChatMember"),e,t)}setChatStickerSet(e,t){return this.api.setChatStickerSet(M(this.chatId,"setChatStickerSet"),e,t)}deleteChatStickerSet(e){return this.api.deleteChatStickerSet(M(this.chatId,"deleteChatStickerSet"),e)}createForumTopic(e,t,i){return this.api.createForumTopic(M(this.chatId,"createForumTopic"),e,t,i)}editForumTopic(e,t){const i=M(this.msg,"editForumTopic"),r=M(i.message_thread_id,"editForumTopic");return this.api.editForumTopic(i.chat.id,r,e,t)}closeForumTopic(e){const t=M(this.msg,"closeForumTopic"),i=M(t.message_thread_id,"closeForumTopic");return this.api.closeForumTopic(t.chat.id,i,e)}reopenForumTopic(e){const t=M(this.msg,"reopenForumTopic"),i=M(t.message_thread_id,"reopenForumTopic");return this.api.reopenForumTopic(t.chat.id,i,e)}deleteForumTopic(e){const t=M(this.msg,"deleteForumTopic"),i=M(t.message_thread_id,"deleteForumTopic");return this.api.deleteForumTopic(t.chat.id,i,e)}unpinAllForumTopicMessages(e){const t=M(this.msg,"unpinAllForumTopicMessages"),i=M(t.message_thread_id,"unpinAllForumTopicMessages");return this.api.unpinAllForumTopicMessages(t.chat.id,i,e)}editGeneralForumTopic(e,t){return this.api.editGeneralForumTopic(M(this.chatId,"editGeneralForumTopic"),e,t)}closeGeneralForumTopic(e){return this.api.closeGeneralForumTopic(M(this.chatId,"closeGeneralForumTopic"),e)}reopenGeneralForumTopic(e){return this.api.reopenGeneralForumTopic(M(this.chatId,"reopenGeneralForumTopic"),e)}hideGeneralForumTopic(e){return this.api.hideGeneralForumTopic(M(this.chatId,"hideGeneralForumTopic"),e)}unhideGeneralForumTopic(e){return this.api.unhideGeneralForumTopic(M(this.chatId,"unhideGeneralForumTopic"),e)}unpinAllGeneralForumTopicMessages(e){return this.api.unpinAllGeneralForumTopicMessages(M(this.chatId,"unpinAllGeneralForumTopicMessages"),e)}answerCallbackQuery(e,t){return this.api.answerCallbackQuery(M(this.callbackQuery,"answerCallbackQuery").id,"string"==typeof e?{text:e}:e,t)}setChatMenuButton(e,t){return this.api.setChatMenuButton(e,t)}getChatMenuButton(e,t){return this.api.getChatMenuButton(e,t)}setMyDefaultAdministratorRights(e,t){return this.api.setMyDefaultAdministratorRights(e,t)}getMyDefaultAdministratorRights(e,t){return this.api.getMyDefaultAdministratorRights(e,t)}editMessageText(e,t,i){const r=this.inlineMessageId;return void 0!==r?this.api.editMessageTextInline(r,e,t):this.api.editMessageText(M(this.chatId,"editMessageText"),M(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"editMessageText"),e,t,i)}editMessageCaption(e,t){const i=this.inlineMessageId;return void 0!==i?this.api.editMessageCaptionInline(i,e):this.api.editMessageCaption(M(this.chatId,"editMessageCaption"),M(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"editMessageCaption"),e,t)}editMessageMedia(e,t,i){const r=this.inlineMessageId;return void 0!==r?this.api.editMessageMediaInline(r,e,t):this.api.editMessageMedia(M(this.chatId,"editMessageMedia"),M(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"editMessageMedia"),e,t,i)}editMessageReplyMarkup(e,t){const i=this.inlineMessageId;return void 0!==i?this.api.editMessageReplyMarkupInline(i,e):this.api.editMessageReplyMarkup(M(this.chatId,"editMessageReplyMarkup"),M(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"editMessageReplyMarkup"),e,t)}stopPoll(e,t){return this.api.stopPoll(M(this.chatId,"stopPoll"),M(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"stopPoll"),e,t)}deleteMessage(e){return this.api.deleteMessage(M(this.chatId,"deleteMessage"),M(this.msg?.message_id??this.messageReaction?.message_id??this.messageReactionCount?.message_id,"deleteMessage"),e)}deleteMessages(e,t){return this.api.deleteMessages(M(this.chatId,"deleteMessages"),e,t)}replyWithSticker(e,t,i){return this.api.sendSticker(M(this.chatId,"sendSticker"),e,{business_connection_id:this.businessConnectionId,...t},i)}getCustomEmojiStickers(e){return this.api.getCustomEmojiStickers((this.msg?.entities??[]).filter((e=>"custom_emoji"===e.type)).map((e=>e.custom_emoji_id)),e)}answerInlineQuery(e,t,i){return this.api.answerInlineQuery(M(this.inlineQuery,"answerInlineQuery").id,e,t,i)}replyWithInvoice(e,t,i,r,s,n,o){return this.api.sendInvoice(M(this.chatId,"sendInvoice"),e,t,i,r,s,n,o)}answerShippingQuery(e,t,i){return this.api.answerShippingQuery(M(this.shippingQuery,"answerShippingQuery").id,e,t,i)}answerPreCheckoutQuery(e,t,i){return this.api.answerPreCheckoutQuery(M(this.preCheckoutQuery,"answerPreCheckoutQuery").id,e,"string"==typeof t?{error_message:t}:t,i)}refundStarPayment(e){return this.api.refundStarPayment(M(this.from,"refundStarPayment").id,M(this.msg?.successful_payment,"refundStarPayment").telegram_payment_charge_id,e)}setPassportDataErrors(e,t){return this.api.setPassportDataErrors(M(this.from,"setPassportDataErrors").id,e,t)}replyWithGame(e,t,i){return this.api.sendGame(M(this.chatId,"sendGame"),e,{business_connection_id:this.businessConnectionId,...t},i)}}function M(e,t){if(void 0===e)throw new Error(`Missing information for API call to ${t}`);return e}function T(e){return S(e).map((e=>"string"==typeof e?t=>t===e?e:null:t=>t.match(e)))}function x(e,t,i){for(const r of i){const i=r(t);if(i)return e.match=i,!0}return!1}function S(e){return Array.isArray(e)?e:[e]}class E extends Error{error;ctx;constructor(e,t){super(function(e){let t;if(e instanceof Error)t=`${e.name} in middleware: ${e.message}`;else{const i=typeof e;switch(t=`Non-error value of type ${i} thrown in middleware`,i){case"bigint":case"boolean":case"number":case"symbol":t+=`: ${e}`;break;case"string":t+=`: ${String(e).substring(0,50)}`;break;default:t+="!"}}return t}(e)),this.error=e,this.ctx=t,this.name="BotError",e instanceof Error&&(this.stack=e.stack)}}function A(e){return"function"==typeof e?e:(t,i)=>e.middleware()(t,i)}function F(e,t){return async(i,r)=>{let s=!1;await e(i,(async()=>{if(s)throw new Error("`next` already called before!");s=!0,await t(i,r)}))}}function R(e,t){return t()}const L=()=>Promise.resolve();async function P(e,t){await e(t,L)}class j{handler;constructor(...e){this.handler=0===e.length?R:e.map(A).reduce(F)}middleware(){return this.handler}use(...e){const t=new j(...e);return this.handler=F(this.handler,A(t)),t}on(e,...t){return this.filter(I.has.filterQuery(e),...t)}hears(e,...t){return this.filter(I.has.text(e),...t)}command(e,...t){return this.filter(I.has.command(e),...t)}reaction(e,...t){return this.filter(I.has.reaction(e),...t)}chatType(e,...t){return this.filter(I.has.chatType(e),...t)}callbackQuery(e,...t){return this.filter(I.has.callbackQuery(e),...t)}gameQuery(e,...t){return this.filter(I.has.gameQuery(e),...t)}inlineQuery(e,...t){return this.filter(I.has.inlineQuery(e),...t)}chosenInlineResult(e,...t){return this.filter(I.has.chosenInlineResult(e),...t)}preCheckoutQuery(e,...t){return this.filter(I.has.preCheckoutQuery(e),...t)}shippingQuery(e,...t){return this.filter(I.has.shippingQuery(e),...t)}filter(e,...t){const i=new j(...t);return this.branch(e,i,R),i}drop(e,...t){return this.filter((async t=>!await e(t)),...t)}fork(...e){const t=new j(...e),i=A(t);return this.use(((e,t)=>Promise.all([t(),P(i,e)]))),t}lazy(e){return this.use((async(t,i)=>{const r=await e(t),s=Array.isArray(r)?r:[r];await A(new j(...s))(t,i)}))}route(e,t,i=R){return this.lazy((async r=>{const s=await e(r);return(void 0!==s&&t[s]?t[s]:i)??[]}))}branch(e,t,i){return this.lazy((async r=>await e(r)?t:i))}errorBoundary(e,...t){const i=new j(...t),r=A(i);return this.use((async(t,i)=>{let s=!1;const n=()=>(s=!0,Promise.resolve());try{await r(t,n)}catch(i){s=!1,await e(new E(i,t),n)}s&&await i()})),i}}var N=1e3,D=60*N,$=60*D,O=24*$,Q=7*O,q=365.25*O,U=function(e,t){t=t||{};var i=typeof e;if("string"===i&&e.length>0)return function(e){if(e=String(e),e.length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var i=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return i*q;case"weeks":case"week":case"w":return i*Q;case"days":case"day":case"d":return i*O;case"hours":case"hour":case"hrs":case"hr":case"h":return i*$;case"minutes":case"minute":case"mins":case"min":case"m":return i*D;case"seconds":case"second":case"secs":case"sec":case"s":return i*N;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}(e);if("number"===i&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=O)return V(e,t,O,"day");if(t>=$)return V(e,t,$,"hour");if(t>=D)return V(e,t,D,"minute");if(t>=N)return V(e,t,N,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=O)return Math.round(e/O)+"d";if(t>=$)return Math.round(e/$)+"h";if(t>=D)return Math.round(e/D)+"m";if(t>=N)return Math.round(e/N)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function V(e,t,i,r){var s=t>=1.5*i;return Math.round(e/i)+" "+r+(s?"s":"")}function G(){throw new Error("setTimeout has not been defined")}function B(){throw new Error("clearTimeout has not been defined")}var J,W=G,K=B;function Y(e){if(W===setTimeout)return setTimeout(e,0);if((W===G||!W)&&setTimeout)return W=setTimeout,setTimeout(e,0);try{return W(e,0)}catch(t){try{return W.call(null,e,0)}catch(t){return W.call(this,e,0)}}}"function"==typeof(J="undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).setTimeout&&(W=setTimeout),"function"==typeof J.clearTimeout&&(K=clearTimeout);var H,z=[],X=!1,Z=-1;function ee(){X&&H&&(X=!1,H.length?z=H.concat(z):Z=-1,z.length&&te())}function te(){if(!X){var e=Y(ee);X=!0;for(var t=z.length;t;){for(H=z,z=[];++Z<t;)H&&H[Z].run();Z=-1,t=z.length}H=null,X=!1,function(e){if(K===clearTimeout)return clearTimeout(e);if((K===B||!K)&&clearTimeout)return K=clearTimeout,clearTimeout(e);try{return K(e)}catch(t){try{return K.call(null,e)}catch(t){return K.call(this,e)}}}(e)}}function ie(e,t){this.fun=e,this.array=t}ie.prototype.run=function(){this.fun.apply(null,this.array)};function re(){}var se=re,ne=re,oe=re,ae=re,ce=re,he=re,ue=re;var de=J.performance||{},le=de.now||de.mozNow||de.msNow||de.oNow||de.webkitNow||function(){return(new Date).getTime()};var pe=new Date;var me={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];z.push(new ie(e,t)),1!==z.length||X||Y(te)},title:"browser",browser:!0,env:{NODE_ENV:"production"},argv:[],version:"",versions:{},on:se,addListener:ne,once:oe,off:ae,removeListener:ce,removeAllListeners:he,emit:ue,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*le.call(de),i=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(i-=e[0],(r-=e[1])<0&&(i--,r+=1e9)),[i,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-pe)/1e3}};var ge,fe,_e,ye=function(e){function t(e){let r,s,n,o=null;function a(...e){if(!a.enabled)return;const i=a,s=Number(new Date),n=s-(r||s);i.diff=n,i.prev=r,i.curr=s,r=s,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,s)=>{if("%%"===r)return"%";o++;const n=t.formatters[s];if("function"==typeof n){const t=e[o];r=n.call(i,t),e.splice(o,1),o--}return r})),t.formatArgs.call(i,e);(i.log||t.log).apply(i,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=i,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(s!==t.namespaces&&(s=t.namespaces,n=t.enabled(e)),n),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function i(e,i){const r=t(this.namespace+(void 0===i?":":i)+e);return r.log=this.log,r}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(r),...t.skips.map(r).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let i;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),s=r.length;for(i=0;i<s;i++)r[i]&&("-"===(e=r[i].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let i,r;for(i=0,r=t.skips.length;i<r;i++)if(t.skips[i].test(e))return!1;for(i=0,r=t.names.length;i<r;i++)if(t.names[i].test(e))return!0;return!1},t.humanize=U,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((i=>{t[i]=e[i]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let i=0;for(let t=0;t<e.length;t++)i=(i<<5)-i+e.charCodeAt(t),i|=0;return t.colors[Math.abs(i)%t.colors.length]},t.enable(t.load()),t},Ce=(ge=function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const i="color: "+this.color;t.splice(1,0,i,"color: inherit");let r=0,s=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(s=r))})),t.splice(s,0,i)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"env"in me&&(e=me.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=ye(t);const{formatters:i}=e.exports;i.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},_e={path:fe,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&_e.path)}},ge(_e,_e.exports),_e.exports);Ce.colors,Ce.destroy,Ce.formatArgs,Ce.load,Ce.log,Ce.save,Ce.storage,Ce.useColors;const we=Ce("grammy:warn");class be extends Error{method;payload;ok;error_code;description;parameters;constructor(e,t,i,r){super(`${e} (${t.error_code}: ${t.description})`),this.method=i,this.payload=r,this.ok=!1,this.name="GrammyError",this.error_code=t.error_code,this.description=t.description,this.parameters=t.parameters??{}}}class ve extends Error{error;constructor(e,t){super(e),this.error=t,this.name="HttpError"}}const ke="windows"===(()=>{const{Deno:e}=globalThis;if("string"==typeof e?.build?.os)return e.build.os;const{navigator:t}=globalThis;return t?.appVersion?.includes?.("Win")?"windows":"linux"})();function Ie(e,t){if(t.length>=e.length)return e;const i=e.length-t.length;for(let r=t.length-1;r>=0;--r)if(e.charCodeAt(i+r)!==t.charCodeAt(r))return e;return e.slice(0,-t.length)}function Me(e,t,i=0){let r=!1,s=e.length;for(let n=e.length-1;n>=i;--n)if(t(e.charCodeAt(n))){if(r){i=n+1;break}}else r||(r=!0,s=n+1);return e.slice(i,s)}function Te(e,t){if(function(e){if("string"!=typeof e)throw new TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}(e),0===e.length)return e;if("string"!=typeof t)throw new TypeError(`Suffix must be a string. Received ${JSON.stringify(t)}`)}function xe(e,t){if(e.length<=1)return e;let i=e.length;for(let r=e.length-1;r>0&&t(e.charCodeAt(r));r--)i=r;return e.slice(0,i)}function Se(e){return 47===e}function Ee(e){return 47===e||92===e}function Ae(e,t=""){return ke?function(e,t=""){Te(e,t);let i=0;if(e.length>=2){((r=e.charCodeAt(0))>=97&&r<=122||r>=65&&r<=90)&&58===e.charCodeAt(1)&&(i=2)}var r;const s=xe(Me(e,Ee,i),Ee);return t?Ie(s,t):s}(e,t):function(e,t=""){Te(e,t);const i=xe(Me(e,Se),Se);return t?Ie(i,t):i}(e,t)}class Fe{consumed=!1;fileData;filename;constructor(e,t){this.fileData=e,t??=this.guessFilename(e),this.filename=t}guessFilename(e){if("string"==typeof e)return Ae(e);if("object"==typeof e){if("url"in e)return Ae(e.url);if(e instanceof URL)return Ae(e.pathname)||Ae(e.hostname)}}toRaw(){if(this.consumed)throw new Error("Cannot reuse InputFile data source!");const e=this.fileData;return e instanceof Blob?e.stream():e instanceof URL?Re(e):"url"in e?Re(e.url):(e instanceof Uint8Array||(this.consumed=!0),e)}}async function*Re(e){const{body:t}=await fetch(e);if(null===t)throw new Error(`Download failed, no response body from '${e}'`);yield*t}function Le(e){return e instanceof Fe||"object"==typeof e&&null!==e&&Object.values(e).some((e=>Array.isArray(e)?e.some(Le):e instanceof Fe||Le(e)))}function Pe(e){return JSON.stringify(e,((e,t)=>t??void 0))}function je(e){return{method:"POST",headers:{"content-type":"application/json",connection:"keep-alive"},body:Pe(e)}}function Ne(e,t){const i="----------"+De(32),r=async function*(e,t){const i=Oe(e);yield $e.encode(`--${t}\r\n`);const r=$e.encode(`\r\n--${t}\r\n`);let s=!0;for(const[t,i]of Object.entries(e))null!=i&&(s||(yield r),yield Qe(t,"object"==typeof i?Pe(i):i),s=!1);for(const{id:e,origin:t,file:n}of i)s||(yield r),yield*qe(e,t,n),s=!1;yield $e.encode(`\r\n--${t}--\r\n`)}(e,i),s=async function*(e,t){try{yield*e}catch(e){t(e)}}(r,t),n=(e=>{const t=e[Symbol.asyncIterator]();return new ReadableStream({async pull(e){const i=await t.next();i.done?e.close():e.enqueue(i.value)}})})(s);return{method:"POST",headers:{"content-type":`multipart/form-data; boundary=${i}`,connection:"keep-alive"},body:n}}function De(e=16){return Array.from(Array(e)).map((()=>Math.random().toString(36)[2]||0)).join("")}const $e=new TextEncoder;function Oe(e){return"object"!=typeof e||null===e?[]:Object.entries(e).flatMap((([t,i])=>{if(Array.isArray(i))return i.flatMap((e=>Oe(e)));if(i instanceof Fe){const r=De();Object.assign(e,{[t]:`attach://${r}`});return{id:r,origin:"media"===t&&"type"in e&&"string"==typeof e.type?e.type:t,file:i}}return Oe(i)}))}function Qe(e,t){return $e.encode(`content-disposition:form-data;name="${e}"\r\n\r\n${t}`)}async function*qe(e,t,i){const r=i.filename||`${t}.${function(e){switch(e){case"certificate":return"pem";case"photo":case"thumbnail":return"jpg";case"voice":return"ogg";case"audio":return"mp3";case"animation":case"video":case"video_note":return"mp4";case"sticker":return"webp";default:return"dat"}}(t)}`;if(r.includes("\r")||r.includes("\n"))throw new Error(`File paths cannot contain carriage-return (\\r) or newline (\\n) characters! Filename for property '${t}' was:\n"""\n${r}\n"""`);yield $e.encode(`content-disposition:form-data;name="${e}";filename=${r}\r\ncontent-type:application/octet-stream\r\n\r\n`);const s=await i.toRaw();s instanceof Uint8Array?yield s:yield*s}const Ue=Ce("grammy:core");function Ve(e,t){return(i,r,s)=>t(e,i,r,s)}class Ge{token;webhookReplyEnvelope;options;hasUsedWebhookReply;installedTransformers;constructor(e,t={},i={}){this.token=e,this.webhookReplyEnvelope=i,this.hasUsedWebhookReply=!1,this.installedTransformers=[],this.call=async(e,t,i)=>{const r=t??{};Ue(`Calling ${e}`),void 0!==i&&function(e,t,i){if("function"==typeof i?.addEventListener)return;let r=JSON.stringify(t);r.length>20&&(r=r.substring(0,16)+" ...");let s=JSON.stringify(i);s.length>20&&(s=s.substring(0,16)+" ...");throw new Error(`Incorrect abort signal instance found! You passed two payloads to '${e}' but you should merge the second one containing '${s}' into the first one containing '${r}'! If you are using context shortcuts, you may want to use a method on 'ctx.api' instead.\n\nIf you want to prevent such mistakes in the future, consider using TypeScript. https://www.typescriptlang.org/`)}(e,r,i);const s=this.options,n=Le(r);if(void 0!==this.webhookReplyEnvelope.send&&!this.hasUsedWebhookReply&&!n&&s.canUseWebhookReply(e)){this.hasUsedWebhookReply=!0;const t=je({...r,method:e});return await this.webhookReplyEnvelope.send(t.body),{ok:!0,result:!0}}const o=function(e){const t=new AbortController;if(void 0===e)return t;const i=e;function r(){t.abort(),i.removeEventListener("abort",r)}i.aborted?r():i.addEventListener("abort",r);return{abort:r,signal:t.signal}}(i),a=function(e,t,i){let r;const s=new Promise(((s,n)=>{r=setTimeout((()=>{n(new Error(`Request to '${i}' timed out after ${t} seconds`)),e.abort()}),1e3*t)}));return{promise:s,handle:r}}(o,s.timeoutSeconds,e),c=function(e){let t=e=>{throw e};return{promise:new Promise(((i,r)=>{t=t=>{r(t),e.abort()}})),catch:t}}(o),h=s.buildUrl(s.apiRoot,this.token,e,s.environment),u=n?Ne(r,(e=>c.catch(e))):je(r),d=o.signal,l={...s.baseFetchConfig,signal:d,...u},p=fetch(h instanceof URL?h.href:h,l).catch(function(e,t){return i=>{let r=`Network request for '${e}' failed!`;throw function(e){return"object"==typeof e&&null!==e&&"status"in e&&"statusText"in e}(i)&&(r+=` (${i.status}: ${i.statusText})`),t&&i instanceof Error&&(r+=` ${i.message}`),new ve(r,i)}}(e,s.sensitiveLogs)),m=[p,c.promise,a.promise];try{const e=await Promise.race(m);return await e.json()}finally{void 0!==a.handle&&clearTimeout(a.handle)}};const r=t.apiRoot??"https://api.telegram.org",s=t.environment??"prod";if(this.options={apiRoot:r,environment:s,buildUrl:t.buildUrl??Be,timeoutSeconds:t.timeoutSeconds??500,baseFetchConfig:{...t.baseFetchConfig},canUseWebhookReply:t.canUseWebhookReply??(()=>!1),sensitiveLogs:t.sensitiveLogs??!1},this.options.apiRoot.endsWith("/"))throw new Error(`Remove the trailing '/' from the 'apiRoot' option (use '${this.options.apiRoot.substring(0,this.options.apiRoot.length-1)}' instead of '${this.options.apiRoot}')`)}call;use(...e){return this.call=e.reduce(Ve,this.call),this.installedTransformers.push(...e),this}async callApi(e,t,i){const r=await this.call(e,t,i);if(r.ok)return r.result;throw function(e,t,i){switch(e.error_code){case 401:we("Error 401 means that your bot token is wrong, talk to https://t.me/BotFather to check it.");break;case 409:we("Error 409 means that you are running your bot several times on long polling. Consider revoking the bot token if you believe that no other instance is running.")}return new be(`Call to '${t}' failed!`,e,t,i)}(r,e,t)}}const Be=(e,t,i,r)=>`${e}/bot${t}/${"test"===r?"test/":""}${i}`,Je={set:()=>!1,defineProperty:()=>!1,deleteProperty:()=>!1,ownKeys:()=>[]};class We{token;options;raw;config;constructor(e,t,i){this.token=e,this.options=t;const{raw:r,use:s,installedTransformers:n}=function(e,t,i){const r=new Ge(e,t,i),s={get:(e,t)=>"toJSON"===t?"__internal":r.callApi.bind(r,t),...Je},n={raw:new Proxy({},s),installedTransformers:r.installedTransformers,use:(...e)=>(r.use(...e),n)};return n}(e,t,i);this.raw=r,this.config={use:s,installedTransformers:()=>n.slice()}}getUpdates(e,t){return this.raw.getUpdates({...e},t)}setWebhook(e,t,i){return this.raw.setWebhook({url:e,...t},i)}deleteWebhook(e,t){return this.raw.deleteWebhook({...e},t)}getWebhookInfo(e){return this.raw.getWebhookInfo(e)}getMe(e){return this.raw.getMe(e)}logOut(e){return this.raw.logOut(e)}close(e){return this.raw.close(e)}sendMessage(e,t,i,r){return this.raw.sendMessage({chat_id:e,text:t,...i},r)}forwardMessage(e,t,i,r,s){return this.raw.forwardMessage({chat_id:e,from_chat_id:t,message_id:i,...r},s)}forwardMessages(e,t,i,r,s){return this.raw.forwardMessages({chat_id:e,from_chat_id:t,message_ids:i,...r},s)}copyMessage(e,t,i,r,s){return this.raw.copyMessage({chat_id:e,from_chat_id:t,message_id:i,...r},s)}copyMessages(e,t,i,r,s){return this.raw.copyMessages({chat_id:e,from_chat_id:t,message_ids:i,...r},s)}sendPhoto(e,t,i,r){return this.raw.sendPhoto({chat_id:e,photo:t,...i},r)}sendAudio(e,t,i,r){return this.raw.sendAudio({chat_id:e,audio:t,...i},r)}sendDocument(e,t,i,r){return this.raw.sendDocument({chat_id:e,document:t,...i},r)}sendVideo(e,t,i,r){return this.raw.sendVideo({chat_id:e,video:t,...i},r)}sendAnimation(e,t,i,r){return this.raw.sendAnimation({chat_id:e,animation:t,...i},r)}sendVoice(e,t,i,r){return this.raw.sendVoice({chat_id:e,voice:t,...i},r)}sendVideoNote(e,t,i,r){return this.raw.sendVideoNote({chat_id:e,video_note:t,...i},r)}sendMediaGroup(e,t,i,r){return this.raw.sendMediaGroup({chat_id:e,media:t,...i},r)}sendLocation(e,t,i,r,s){return this.raw.sendLocation({chat_id:e,latitude:t,longitude:i,...r},s)}editMessageLiveLocation(e,t,i,r,s,n){return this.raw.editMessageLiveLocation({chat_id:e,message_id:t,latitude:i,longitude:r,...s},n)}editMessageLiveLocationInline(e,t,i,r,s){return this.raw.editMessageLiveLocation({inline_message_id:e,latitude:t,longitude:i,...r},s)}stopMessageLiveLocation(e,t,i,r){return this.raw.stopMessageLiveLocation({chat_id:e,message_id:t,...i},r)}stopMessageLiveLocationInline(e,t,i){return this.raw.stopMessageLiveLocation({inline_message_id:e,...t},i)}sendPaidMedia(e,t,i,r,s){return this.raw.sendPaidMedia({chat_id:e,star_count:t,media:i,...r},s)}sendVenue(e,t,i,r,s,n,o){return this.raw.sendVenue({chat_id:e,latitude:t,longitude:i,title:r,address:s,...n},o)}sendContact(e,t,i,r,s){return this.raw.sendContact({chat_id:e,phone_number:t,first_name:i,...r},s)}sendPoll(e,t,i,r,s){return this.raw.sendPoll({chat_id:e,question:t,options:i,...r},s)}sendDice(e,t,i,r){return this.raw.sendDice({chat_id:e,emoji:t,...i},r)}setMessageReaction(e,t,i,r,s){return this.raw.setMessageReaction({chat_id:e,message_id:t,reaction:i,...r},s)}sendChatAction(e,t,i,r){return this.raw.sendChatAction({chat_id:e,action:t,...i},r)}getUserProfilePhotos(e,t,i){return this.raw.getUserProfilePhotos({user_id:e,...t},i)}getUserChatBoosts(e,t,i){return this.raw.getUserChatBoosts({chat_id:e,user_id:t},i)}getBusinessConnection(e,t){return this.raw.getBusinessConnection({business_connection_id:e},t)}getFile(e,t){return this.raw.getFile({file_id:e},t)}kickChatMember(...e){return this.banChatMember(...e)}banChatMember(e,t,i,r){return this.raw.banChatMember({chat_id:e,user_id:t,...i},r)}unbanChatMember(e,t,i,r){return this.raw.unbanChatMember({chat_id:e,user_id:t,...i},r)}restrictChatMember(e,t,i,r,s){return this.raw.restrictChatMember({chat_id:e,user_id:t,permissions:i,...r},s)}promoteChatMember(e,t,i,r){return this.raw.promoteChatMember({chat_id:e,user_id:t,...i},r)}setChatAdministratorCustomTitle(e,t,i,r){return this.raw.setChatAdministratorCustomTitle({chat_id:e,user_id:t,custom_title:i},r)}banChatSenderChat(e,t,i){return this.raw.banChatSenderChat({chat_id:e,sender_chat_id:t},i)}unbanChatSenderChat(e,t,i){return this.raw.unbanChatSenderChat({chat_id:e,sender_chat_id:t},i)}setChatPermissions(e,t,i,r){return this.raw.setChatPermissions({chat_id:e,permissions:t,...i},r)}exportChatInviteLink(e,t){return this.raw.exportChatInviteLink({chat_id:e},t)}createChatInviteLink(e,t,i){return this.raw.createChatInviteLink({chat_id:e,...t},i)}editChatInviteLink(e,t,i,r){return this.raw.editChatInviteLink({chat_id:e,invite_link:t,...i},r)}createChatSubscriptionInviteLink(e,t,i,r,s){return this.raw.createChatSubscriptionInviteLink({chat_id:e,subscription_period:t,subscription_price:i,...r},s)}editChatSubscriptionInviteLink(e,t,i,r){return this.raw.editChatSubscriptionInviteLink({chat_id:e,invite_link:t,...i},r)}revokeChatInviteLink(e,t,i){return this.raw.revokeChatInviteLink({chat_id:e,invite_link:t},i)}approveChatJoinRequest(e,t,i){return this.raw.approveChatJoinRequest({chat_id:e,user_id:t},i)}declineChatJoinRequest(e,t,i){return this.raw.declineChatJoinRequest({chat_id:e,user_id:t},i)}setChatPhoto(e,t,i){return this.raw.setChatPhoto({chat_id:e,photo:t},i)}deleteChatPhoto(e,t){return this.raw.deleteChatPhoto({chat_id:e},t)}setChatTitle(e,t,i){return this.raw.setChatTitle({chat_id:e,title:t},i)}setChatDescription(e,t,i){return this.raw.setChatDescription({chat_id:e,description:t},i)}pinChatMessage(e,t,i,r){return this.raw.pinChatMessage({chat_id:e,message_id:t,...i},r)}unpinChatMessage(e,t,i){return this.raw.unpinChatMessage({chat_id:e,message_id:t},i)}unpinAllChatMessages(e,t){return this.raw.unpinAllChatMessages({chat_id:e},t)}leaveChat(e,t){return this.raw.leaveChat({chat_id:e},t)}getChat(e,t){return this.raw.getChat({chat_id:e},t)}getChatAdministrators(e,t){return this.raw.getChatAdministrators({chat_id:e},t)}getChatMembersCount(...e){return this.getChatMemberCount(...e)}getChatMemberCount(e,t){return this.raw.getChatMemberCount({chat_id:e},t)}getChatMember(e,t,i){return this.raw.getChatMember({chat_id:e,user_id:t},i)}setChatStickerSet(e,t,i){return this.raw.setChatStickerSet({chat_id:e,sticker_set_name:t},i)}deleteChatStickerSet(e,t){return this.raw.deleteChatStickerSet({chat_id:e},t)}getForumTopicIconStickers(e){return this.raw.getForumTopicIconStickers(e)}createForumTopic(e,t,i,r){return this.raw.createForumTopic({chat_id:e,name:t,...i},r)}editForumTopic(e,t,i,r){return this.raw.editForumTopic({chat_id:e,message_thread_id:t,...i},r)}closeForumTopic(e,t,i){return this.raw.closeForumTopic({chat_id:e,message_thread_id:t},i)}reopenForumTopic(e,t,i){return this.raw.reopenForumTopic({chat_id:e,message_thread_id:t},i)}deleteForumTopic(e,t,i){return this.raw.deleteForumTopic({chat_id:e,message_thread_id:t},i)}unpinAllForumTopicMessages(e,t,i){return this.raw.unpinAllForumTopicMessages({chat_id:e,message_thread_id:t},i)}editGeneralForumTopic(e,t,i){return this.raw.editGeneralForumTopic({chat_id:e,name:t},i)}closeGeneralForumTopic(e,t){return this.raw.closeGeneralForumTopic({chat_id:e},t)}reopenGeneralForumTopic(e,t){return this.raw.reopenGeneralForumTopic({chat_id:e},t)}hideGeneralForumTopic(e,t){return this.raw.hideGeneralForumTopic({chat_id:e},t)}unhideGeneralForumTopic(e,t){return this.raw.unhideGeneralForumTopic({chat_id:e},t)}unpinAllGeneralForumTopicMessages(e,t){return this.raw.unpinAllGeneralForumTopicMessages({chat_id:e},t)}answerCallbackQuery(e,t,i){return this.raw.answerCallbackQuery({callback_query_id:e,...t},i)}setMyName(e,t,i){return this.raw.setMyName({name:e,...t},i)}getMyName(e,t){return this.raw.getMyName(e??{},t)}setMyCommands(e,t,i){return this.raw.setMyCommands({commands:e,...t},i)}deleteMyCommands(e,t){return this.raw.deleteMyCommands({...e},t)}getMyCommands(e,t){return this.raw.getMyCommands({...e},t)}setMyDescription(e,t,i){return this.raw.setMyDescription({description:e,...t},i)}getMyDescription(e,t){return this.raw.getMyDescription({...e},t)}setMyShortDescription(e,t,i){return this.raw.setMyShortDescription({short_description:e,...t},i)}getMyShortDescription(e,t){return this.raw.getMyShortDescription({...e},t)}setChatMenuButton(e,t){return this.raw.setChatMenuButton({...e},t)}getChatMenuButton(e,t){return this.raw.getChatMenuButton({...e},t)}setMyDefaultAdministratorRights(e,t){return this.raw.setMyDefaultAdministratorRights({...e},t)}getMyDefaultAdministratorRights(e,t){return this.raw.getMyDefaultAdministratorRights({...e},t)}editMessageText(e,t,i,r,s){return this.raw.editMessageText({chat_id:e,message_id:t,text:i,...r},s)}editMessageTextInline(e,t,i,r){return this.raw.editMessageText({inline_message_id:e,text:t,...i},r)}editMessageCaption(e,t,i,r){return this.raw.editMessageCaption({chat_id:e,message_id:t,...i},r)}editMessageCaptionInline(e,t,i){return this.raw.editMessageCaption({inline_message_id:e,...t},i)}editMessageMedia(e,t,i,r,s){return this.raw.editMessageMedia({chat_id:e,message_id:t,media:i,...r},s)}editMessageMediaInline(e,t,i,r){return this.raw.editMessageMedia({inline_message_id:e,media:t,...i},r)}editMessageReplyMarkup(e,t,i,r){return this.raw.editMessageReplyMarkup({chat_id:e,message_id:t,...i},r)}editMessageReplyMarkupInline(e,t,i){return this.raw.editMessageReplyMarkup({inline_message_id:e,...t},i)}stopPoll(e,t,i,r){return this.raw.stopPoll({chat_id:e,message_id:t,...i},r)}deleteMessage(e,t,i){return this.raw.deleteMessage({chat_id:e,message_id:t},i)}deleteMessages(e,t,i){return this.raw.deleteMessages({chat_id:e,message_ids:t},i)}sendSticker(e,t,i,r){return this.raw.sendSticker({chat_id:e,sticker:t,...i},r)}getStickerSet(e,t){return this.raw.getStickerSet({name:e},t)}getCustomEmojiStickers(e,t){return this.raw.getCustomEmojiStickers({custom_emoji_ids:e},t)}uploadStickerFile(e,t,i,r){return this.raw.uploadStickerFile({user_id:e,sticker_format:t,sticker:i},r)}createNewStickerSet(e,t,i,r,s,n){return this.raw.createNewStickerSet({user_id:e,name:t,title:i,stickers:r,...s},n)}addStickerToSet(e,t,i,r){return this.raw.addStickerToSet({user_id:e,name:t,sticker:i},r)}setStickerPositionInSet(e,t,i){return this.raw.setStickerPositionInSet({sticker:e,position:t},i)}deleteStickerFromSet(e,t){return this.raw.deleteStickerFromSet({sticker:e},t)}replaceStickerInSet(e,t,i,r,s){return this.raw.replaceStickerInSet({user_id:e,name:t,old_sticker:i,sticker:r},s)}setStickerEmojiList(e,t,i){return this.raw.setStickerEmojiList({sticker:e,emoji_list:t},i)}setStickerKeywords(e,t,i){return this.raw.setStickerKeywords({sticker:e,keywords:t},i)}setStickerMaskPosition(e,t,i){return this.raw.setStickerMaskPosition({sticker:e,mask_position:t},i)}setStickerSetTitle(e,t,i){return this.raw.setStickerSetTitle({name:e,title:t},i)}deleteStickerSet(e,t){return this.raw.deleteStickerSet({name:e},t)}setStickerSetThumbnail(e,t,i,r,s){return this.raw.setStickerSetThumbnail({name:e,user_id:t,thumbnail:i,format:r},s)}setCustomEmojiStickerSetThumbnail(e,t,i){return this.raw.setCustomEmojiStickerSetThumbnail({name:e,custom_emoji_id:t},i)}answerInlineQuery(e,t,i,r){return this.raw.answerInlineQuery({inline_query_id:e,results:t,...i},r)}answerWebAppQuery(e,t,i){return this.raw.answerWebAppQuery({web_app_query_id:e,result:t},i)}sendInvoice(e,t,i,r,s,n,o,a){return this.raw.sendInvoice({chat_id:e,title:t,description:i,payload:r,currency:s,prices:n,...o},a)}createInvoiceLink(e,t,i,r,s,n,o,a){return this.raw.createInvoiceLink({title:e,description:t,payload:i,provider_token:r,currency:s,prices:n,...o},a)}answerShippingQuery(e,t,i,r){return this.raw.answerShippingQuery({shipping_query_id:e,ok:t,...i},r)}answerPreCheckoutQuery(e,t,i,r){return this.raw.answerPreCheckoutQuery({pre_checkout_query_id:e,ok:t,...i},r)}getStarTransactions(e,t){return this.raw.getStarTransactions({...e},t)}refundStarPayment(e,t,i){return this.raw.refundStarPayment({user_id:e,telegram_payment_charge_id:t},i)}setPassportDataErrors(e,t,i){return this.raw.setPassportDataErrors({user_id:e,errors:t},i)}sendGame(e,t,i,r){return this.raw.sendGame({chat_id:e,game_short_name:t,...i},r)}setGameScore(e,t,i,r,s,n){return this.raw.setGameScore({chat_id:e,message_id:t,user_id:i,score:r,...s},n)}setGameScoreInline(e,t,i,r,s){return this.raw.setGameScore({inline_message_id:e,user_id:t,score:i,...r},s)}getGameHighScores(e,t,i,r){return this.raw.getGameHighScores({chat_id:e,message_id:t,user_id:i},r)}getGameHighScoresInline(e,t,i){return this.raw.getGameHighScores({inline_message_id:e,user_id:t},i)}}const Ke=Ce("grammy:bot"),Ye=Ce("grammy:warn"),He=Ce("grammy:error"),ze=["message","edited_message","channel_post","edited_channel_post","business_connection","business_message","edited_business_message","deleted_business_messages","inline_query","chosen_inline_result","callback_query","shipping_query","pre_checkout_query","poll","poll_answer","my_chat_member","chat_join_request","chat_boost","removed_chat_boost"];async function Xe(e,t){let i=50;async function r(e){let r=!1,s="rethrow";if(e instanceof ve)r=!0,s="retry";else if(e instanceof be)if(e.error_code>=500)r=!0,s="retry";else if(429===e.error_code){const n=e.parameters.retry_after;"number"==typeof n?(await Ze(n,t),i=50):r=!0,s="retry"}if(r){50!==i&&await Ze(i,t);const e=12e5;i=Math.min(e,2*i)}return s}let s={ok:!1};for(;!s.ok;)try{s={ok:!0,value:await e()}}catch(e){He(e);switch(await r(e)){case"retry":continue;case"rethrow":throw e}}return s.value}async function Ze(e,t){let i,r;function s(){r?.(new Error("Aborted delay")),void 0!==i&&clearTimeout(i)}try{await new Promise(((n,o)=>{r=o,t?.aborted?s():(t?.addEventListener("abort",s),i=setTimeout(n,1e3*e))}))}finally{t?.removeEventListener("abort",s)}}function et(){throw new Error("It looks like you are registering more listeners on your bot from within other listeners! This means that every time your bot handles a message like this one, new listeners will be added. This list grows until your machine crashes, so grammY throws this error to tell you that you should probably do things a bit differently. If you're unsure how to resolve this problem, you can ask in the group chat: https://telegram.me/grammyjs\n\nOn the other hand, if you actually know what you're doing and you do need to install further middleware while your bot is running, consider installing a composer instance on your bot, and in turn augment the composer after the fact. This way, you can circumvent this protection against memory leaks.")}class tt{keyboard;is_persistent;selective;one_time_keyboard;resize_keyboard;input_field_placeholder;constructor(e=[[]]){this.keyboard=e}add(...e){return this.keyboard[this.keyboard.length-1]?.push(...e),this}row(...e){return this.keyboard.push(e),this}text(e){return this.add(tt.text(e))}static text(e){return{text:e}}requestUsers(e,t,i={}){return this.add(tt.requestUsers(e,t,i))}static requestUsers(e,t,i={}){return{text:e,request_users:{request_id:t,...i}}}requestChat(e,t,i={chat_is_channel:!1}){return this.add(tt.requestChat(e,t,i))}static requestChat(e,t,i={chat_is_channel:!1}){return{text:e,request_chat:{request_id:t,...i}}}requestContact(e){return this.add(tt.requestContact(e))}static requestContact(e){return{text:e,request_contact:!0}}requestLocation(e){return this.add(tt.requestLocation(e))}static requestLocation(e){return{text:e,request_location:!0}}requestPoll(e,t){return this.add(tt.requestPoll(e,t))}static requestPoll(e,t){return{text:e,request_poll:{type:t}}}webApp(e,t){return this.add(tt.webApp(e,t))}static webApp(e,t){return{text:e,web_app:{url:t}}}persistent(e=!0){return this.is_persistent=e,this}selected(e=!0){return this.selective=e,this}oneTime(e=!0){return this.one_time_keyboard=e,this}resized(e=!0){return this.resize_keyboard=e,this}placeholder(e){return this.input_field_placeholder=e,this}toTransposed(){const e=rt(this.keyboard);return this.clone(e)}toFlowed(e,t={}){const i=st(this.keyboard,e,t);return this.clone(i)}clone(e=this.keyboard){const t=new tt(e.map((e=>e.slice())));return t.is_persistent=this.is_persistent,t.selective=this.selective,t.one_time_keyboard=this.one_time_keyboard,t.resize_keyboard=this.resize_keyboard,t.input_field_placeholder=this.input_field_placeholder,t}append(...e){for(const t of e){const e=tt.from(t);this.keyboard.push(...e.keyboard.map((e=>e.slice())))}return this}build(){return this.keyboard}static from(e){if(e instanceof tt)return e.clone();function t(e){return"string"==typeof e?tt.text(e):e}return new tt(e.map((e=>e.map(t))))}}class it{inline_keyboard;constructor(e=[[]]){this.inline_keyboard=e}add(...e){return this.inline_keyboard[this.inline_keyboard.length-1]?.push(...e),this}row(...e){return this.inline_keyboard.push(e),this}url(e,t){return this.add(it.url(e,t))}static url(e,t){return{text:e,url:t}}text(e,t=e){return this.add(it.text(e,t))}static text(e,t=e){return{text:e,callback_data:t}}webApp(e,t){return this.add(it.webApp(e,t))}static webApp(e,t){return{text:e,web_app:{url:t}}}login(e,t){return this.add(it.login(e,t))}static login(e,t){return{text:e,login_url:"string"==typeof t?{url:t}:t}}switchInline(e,t=""){return this.add(it.switchInline(e,t))}static switchInline(e,t=""){return{text:e,switch_inline_query:t}}switchInlineCurrent(e,t=""){return this.add(it.switchInlineCurrent(e,t))}static switchInlineCurrent(e,t=""){return{text:e,switch_inline_query_current_chat:t}}switchInlineChosen(e,t={}){return this.add(it.switchInlineChosen(e,t))}static switchInlineChosen(e,t={}){return{text:e,switch_inline_query_chosen_chat:t}}game(e){return this.add(it.game(e))}static game(e){return{text:e,callback_game:{}}}pay(e){return this.add(it.pay(e))}static pay(e){return{text:e,pay:!0}}toTransposed(){const e=rt(this.inline_keyboard);return new it(e)}toFlowed(e,t={}){const i=st(this.inline_keyboard,e,t);return new it(i)}clone(){return new it(this.inline_keyboard.map((e=>e.slice())))}append(...e){for(const t of e){const e=it.from(t);this.inline_keyboard.push(...e.inline_keyboard.map((e=>e.slice())))}return this}static from(e){return e instanceof it?e.clone():new it(e.map((e=>e.slice())))}}function rt(e){const t=[];for(let i=0;i<e.length;i++){const r=e[i];for(let e=0;e<r.length;e++){const i=r[e];(t[e]??=[]).push(i)}}return t}function st(e,t,{fillLastRow:i=!1}){let r=t;if(i){r=e.map((e=>e.length)).reduce(((e,t)=>e+t),0)%t}const s=[];for(const i of e)for(const e of i){const i=Math.max(0,s.length-1),n=0===i?r:t;let o=s[i]??=[];o.length===n&&(o=[],s.push(o)),o.push(e)}return s}function nt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}Ce("grammy:session"),Ce("grammy:error");var ot,at={exports:{}},ct={name:"dotenv",version:"16.4.5",description:"Loads environment variables from .env file",main:"lib/main.js",types:"lib/main.d.ts",exports:{".":{types:"./lib/main.d.ts",require:"./lib/main.js",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},scripts:{"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard","lint-readme":"standard-markdown",pretest:"npm run lint && npm run dts-check",test:"tap tests/*.js --100 -Rspec","test:coverage":"tap --coverage-report=lcov",prerelease:"npm test",release:"standard-version"},repository:{type:"git",url:"git://github.com/motdotla/dotenv.git"},funding:"https://dotenvx.com",keywords:["dotenv","env",".env","environment","variables","config","settings"],readmeFilename:"README.md",license:"BSD-2-Clause",devDependencies:{"@definitelytyped/dtslint":"^0.0.133","@types/node":"^18.11.3",decache:"^4.6.1",sinon:"^14.0.1",standard:"^17.0.0","standard-markdown":"^7.1.0","standard-version":"^9.5.0",tap:"^16.3.0",tar:"^6.1.11",typescript:"^4.8.4"},engines:{node:">=12"},browser:{fs:!1}};var ht=function(){if(ot)return at.exports;ot=1;const s=e,n=t,o=i,a=r,c=ct.version,h=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/gm;function u(e){console.log(`[dotenv@${c}][DEBUG] ${e}`)}function d(e){return e&&e.DOTENV_KEY&&e.DOTENV_KEY.length>0?e.DOTENV_KEY:process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0?process.env.DOTENV_KEY:""}function l(e,t){let i;try{i=new URL(t)}catch(e){if("ERR_INVALID_URL"===e.code){const e=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw e.code="INVALID_DOTENV_KEY",e}throw e}const r=i.password;if(!r){const e=new Error("INVALID_DOTENV_KEY: Missing key part");throw e.code="INVALID_DOTENV_KEY",e}const s=i.searchParams.get("environment");if(!s){const e=new Error("INVALID_DOTENV_KEY: Missing environment part");throw e.code="INVALID_DOTENV_KEY",e}const n=`DOTENV_VAULT_${s.toUpperCase()}`,o=e.parsed[n];if(!o){const e=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${n} in your .env.vault file.`);throw e.code="NOT_FOUND_DOTENV_ENVIRONMENT",e}return{ciphertext:o,key:r}}function p(e){let t=null;if(e&&e.path&&e.path.length>0)if(Array.isArray(e.path))for(const i of e.path)s.existsSync(i)&&(t=i.endsWith(".vault")?i:`${i}.vault`);else t=e.path.endsWith(".vault")?e.path:`${e.path}.vault`;else t=n.resolve(process.cwd(),".env.vault");return s.existsSync(t)?t:null}function m(e){return"~"===e[0]?n.join(o.homedir(),e.slice(1)):e}const g={configDotenv:function(e){const t=n.resolve(process.cwd(),".env");let i="utf8";const r=Boolean(e&&e.debug);e&&e.encoding?i=e.encoding:r&&u("No encoding is specified. UTF-8 is used by default");let o,a=[t];if(e&&e.path)if(Array.isArray(e.path)){a=[];for(const t of e.path)a.push(m(t))}else a=[m(e.path)];const c={};for(const t of a)try{const r=g.parse(s.readFileSync(t,{encoding:i}));g.populate(c,r,e)}catch(e){r&&u(`Failed to load ${t} ${e.message}`),o=e}let h=process.env;return e&&null!=e.processEnv&&(h=e.processEnv),g.populate(h,c,e),o?{parsed:c,error:o}:{parsed:c}},_configVault:function(e){var t;t="Loading env from encrypted .env.vault",console.log(`[dotenv@${c}][INFO] ${t}`);const i=g._parseVault(e);let r=process.env;return e&&null!=e.processEnv&&(r=e.processEnv),g.populate(r,i,e),{parsed:i}},_parseVault:function(e){const t=p(e),i=g.configDotenv({path:t});if(!i.parsed){const e=new Error(`MISSING_DATA: Cannot parse ${t} for an unknown reason`);throw e.code="MISSING_DATA",e}const r=d(e).split(","),s=r.length;let n;for(let e=0;e<s;e++)try{const t=l(i,r[e].trim());n=g.decrypt(t.ciphertext,t.key);break}catch(t){if(e+1>=s)throw t}return g.parse(n)},config:function(e){if(0===d(e).length)return g.configDotenv(e);const t=p(e);return t?g._configVault(e):(i=`You set DOTENV_KEY but you are missing a .env.vault file at ${t}. Did you forget to build it?`,console.log(`[dotenv@${c}][WARN] ${i}`),g.configDotenv(e));var i},decrypt:function(e,t){const i=Buffer.from(t.slice(-64),"hex");let r=Buffer.from(e,"base64");const s=r.subarray(0,12),n=r.subarray(-16);r=r.subarray(12,-16);try{const e=a.createDecipheriv("aes-256-gcm",i,s);return e.setAuthTag(n),`${e.update(r)}${e.final()}`}catch(e){const t=e instanceof RangeError,i="Invalid key length"===e.message,r="Unsupported state or unable to authenticate data"===e.message;if(t||i){const e=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw e.code="INVALID_DOTENV_KEY",e}if(r){const e=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw e.code="DECRYPTION_FAILED",e}throw e}},parse:function(e){const t={};let i,r=e.toString();for(r=r.replace(/\r\n?/gm,"\n");null!=(i=h.exec(r));){const e=i[1];let r=i[2]||"";r=r.trim();const s=r[0];r=r.replace(/^(['"`])([\s\S]*)\1$/gm,"$2"),'"'===s&&(r=r.replace(/\\n/g,"\n"),r=r.replace(/\\r/g,"\r")),t[e]=r}return t},populate:function(e,t,i={}){const r=Boolean(i&&i.debug),s=Boolean(i&&i.override);if("object"!=typeof t){const e=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw e.code="OBJECT_REQUIRED",e}for(const i of Object.keys(t))Object.prototype.hasOwnProperty.call(e,i)?(!0===s&&(e[i]=t[i]),r&&u(!0===s?`"${i}" is already defined and WAS overwritten`:`"${i}" is already defined and was NOT overwritten`)):e[i]=t[i]}};return at.exports.configDotenv=g.configDotenv,at.exports._configVault=g._configVault,at.exports._parseVault=g._parseVault,at.exports.config=g.config,at.exports.decrypt=g.decrypt,at.exports.parse=g.parse,at.exports.populate=g.populate,at.exports=g,at.exports}();const ut={BREAKING_BAD:"Давай во все тяжкие!",NOT_SHURE:"Не уверен"},dt={BASE:"Основы тестирования",PROCESS:"Процессы и методологии",TECHICAL:"Инструменты и технологии",EXPERTISE:"Личные качества и опыт"},lt="Привет! Я QA Interview Bot 🤖 \nЯ помогу пройти ассессмент QA в стриме ITSM \nХорошо подготовились?",pt="Сейчас проверим. Выбери тему вопроса в меню 👇🏻",mt="Верно!",gt="Не верно!",ft="Ошибка получения токена из переменной окружения",_t="Ошибка при обработке обновления",yt="Ошибка в запросе:",Ct="Не удалось установить соединение с Telegram:",wt="Неизвестная ошибка:";nt(ht).config();const bt={base:[{id:1,text:"Какой из следующих типов тестирования выполняется без доступа к исходному коду?",options:[{id:1,text:"Белый ящик",isCorrect:!1},{id:2,text:"Черный ящик",isCorrect:!0},{id:3,text:"Серый ящик",isCorrect:!1},{id:4,text:"Интеграционное тестирование",isCorrect:!1}]},{id:2,text:"Что такое регрессионное тестирование?",options:[{id:1,text:"Тестирование новых функций",isCorrect:!1},{id:2,text:"Тестирование исправлений и изменений",isCorrect:!0},{id:3,text:"Тестирование производительности",isCorrect:!1},{id:4,text:"Тестирование на совместимость",isCorrect:!1}]},{id:3,text:"Какой из следующих методов тестирования является наиболее подходящим для проверки пользовательского интерфейса?",options:[{id:1,text:"Модульное тестирование.",isCorrect:!1},{id:2,text:"Интеграционное тестирование.",isCorrect:!1},{id:3,text:"Системное тестирование.",isCorrect:!0},{id:4,text:"Тестирование безопасности.",isCorrect:!1}]},{id:4,text:"Какой из следующих методов тестирования наиболее подходит для проверки корректности работы системы в условиях различных конфигураций оборудования?",options:[{id:1,text:"Модульное тестирование.",isCorrect:!1},{id:2,text:"Интеграционное тестирование.",isCorrect:!1},{id:3,text:"Системное тестирование.",isCorrect:!0},{id:4,text:"Тестирование безопасности.",isCorrect:!1}]},{id:3,text:"Какой тип тестирования проводится для проверки соответствия системы требованиям заказчика?",options:[{id:1,text:"Модульное тестирование",isCorrect:!1},{id:2,text:"Интеграционное тестирование",isCorrect:!1},{id:3,text:"Системное тестирование",isCorrect:!1},{id:4,text:"Приемочное тестирование",isCorrect:!0}]}],process:[{id:1,text:"Какой из следующих подходов к тестированию лучше всего подходит для Agile-разработки?",options:[{id:1,text:"Водопадная модель",isCorrect:!1},{id:2,text:"Модель V",isCorrect:!1},{id:3,text:"Тестирование на основе рисков",isCorrect:!0},{id:4,text:"Модель спирали",isCorrect:!1}]},{id:2,text:"Что означает аббревиатура SDLC в контексте разработки программного обеспечения?",options:[{id:1,text:"Цикл жизни разработки программного обеспечения",isCorrect:!0},{id:2,text:"Цикл жизни проектирования системы",isCorrect:!1},{id:3,text:"Цикл жизни развертывания программного обеспечения",isCorrect:!1},{id:4,text:"Цикл жизни разработки системы",isCorrect:!1}]},{id:3,text:"Что такое 'пирамида тестирования' и какую роль она играет в эффективном тестировании?",options:[{id:1,text:"Это модель, которая показывает соотношение различных типов тестов и помогает определить приоритеты и баланс между ними",isCorrect:!0},{id:2,text:"Это модель, которая описывает последовательность выполнения различных типов тестов",isCorrect:!1},{id:3,text:"Это модель, которая определяет, какие типы тестов должны выполняться на каждом этапе разработки",isCorrect:!1},{id:4,text:"Это модель, которая показывает, как различные типы тестов взаимодействуют друг с другом",isCorrect:!1}]}],technical:[{id:1,text:"Что такое 'окружения' (Environments) в Postman и для чего они используются?",options:[{id:1,text:"Окружения позволяют создавать и управлять коллекциями запросов.",isCorrect:!1},{id:2,text:"Окружения позволяют хранить и управлять переменными, которые могут быть использованы в запросах и тестах.",isCorrect:!0},{id:3,text:"Окружения позволяют автоматизировать выполнение запросов.",isCorrect:!1},{id:4,text:"Окружения позволяют создавать и управлять документацией API.",isCorrect:!1}]},{id:2,text:"Какие виды JOIN существуют в SQL?",options:[{id:1,text:"INNER JOIN, LEFT JOIN, RIGHT JOIN, FULL JOIN",isCorrect:!0},{id:2,text:"INNER JOIN, LEFT JOIN, RIGHT JOIN, CROSS JOIN",isCorrect:!1},{id:3,text:"INNER JOIN, LEFT JOIN, RIGHT JOIN, SELF JOIN",isCorrect:!1},{id:4,text:"INNER JOIN, LEFT JOIN, RIGHT JOIN, OUTER JOIN",isCorrect:!1}]},{id:3,text:"Что такое 'заголовки' (Headers) в HTTP и для чего они используются?",options:[{id:1,text:"Заголовки используются для передачи данных между клиентом и сервером, которые не являются частью тела сообщения.",isCorrect:!0},{id:2,text:"Заголовки используются только для передачи данных о типе контента.",isCorrect:!1},{id:3,text:"Заголовки используются только для передачи данных о статусе ответа сервера.",isCorrect:!1},{id:4,text:"Заголовки используются только для передачи данных о времени выполнения запроса.",isCorrect:!1}]}],expertise:[{id:1,text:"Что делать, если найденный вами баг не воспроизводится у разработчика?",options:[{id:1,text:"Закрыть баг как невоспроизводимый",isCorrect:!1},{id:2,text:"Попросить разработчика попробовать на другой машине",isCorrect:!1},{id:3,text:"Предоставить разработчику подробную информацию о шагах воспроизведения, окружении и логах",isCorrect:!0},{id:4,text:"Проигнорировать баг и перейти к следующему",isCorrect:!1}]},{id:2,text:"Как лучше поступить, если найденный вами баг критический, но его исправление может задержать релиз?",options:[{id:1,text:"Закрыть баг как некритический",isCorrect:!1},{id:2,text:"Обсудить с командой возможность отложить релиз",isCorrect:!0},{id:3,text:"Проигнорировать баг и выпустить релиз",isCorrect:!1},{id:4,text:"Попросить разработчика быстро исправить баг",isCorrect:!1}]},{id:4,text:"Как лучше поступить, если найденный вами баг не воспроизводится на тестовом окружении, но воспроизводится на продовом?",options:[{id:1,text:"Закрыть баг как невоспроизводимый",isCorrect:!1},{id:2,text:"Попросить разработчика воспроизвести баг на продовом окружении",isCorrect:!1},{id:3,text:"Предоставить разработчику информацию о различиях между тестовым и продовым окружением",isCorrect:!0},{id:4,text:"Проигнорировать баг и перейти к следующему",isCorrect:!1}]},{id:5,text:"Что делать, если найденный вами баг не воспроизводится после обновления версии приложения?",options:[{id:1,text:"Закрыть баг как невоспроизводимый",isCorrect:!0},{id:2,text:"Попросить разработчика воспроизвести баг на старой версии",isCorrect:!1},{id:3,text:"Зарегистрировать новый баг с теми же шагами воспроизведения",isCorrect:!1},{id:4,text:"Проигнорировать баг и перейти к следующему",isCorrect:!1}]}]};const{BASE:vt,PROCESS:kt,TECHICAL:It,EXPERTISE:Mt}=dt,Tt=new class extends j{token;pollingRunning;pollingAbortController;lastTriedUpdateId;api;me;mePromise;clientConfig;ContextConstructor;observedUpdateTypes;errorHandler;constructor(e,t){if(super(),this.token=e,this.pollingRunning=!1,this.lastTriedUpdateId=0,this.observedUpdateTypes=new Set,this.errorHandler=async e=>{throw console.error("Error in middleware while handling update",e.ctx?.update?.update_id,e.error),console.error("No error handler was set!"),console.error("Set your own error handler with `bot.catch = ...`"),this.pollingRunning&&(console.error("Stopping bot"),await this.stop()),e},!e)throw new Error("Empty token!");this.me=t?.botInfo,this.clientConfig=t?.client,this.ContextConstructor=t?.ContextConstructor??I,this.api=new We(e,this.clientConfig)}set botInfo(e){this.me=e}get botInfo(){if(void 0===this.me)throw new Error("Bot information unavailable! Make sure to call `await bot.init()` before accessing `bot.botInfo`!");return this.me}on(e,...t){for(const[t]of o(e).flatMap(a))this.observedUpdateTypes.add(t);return super.on(e,...t)}reaction(e,...t){return this.observedUpdateTypes.add("message_reaction"),super.reaction(e,...t)}isInited(){return void 0!==this.me}async init(e){if(!this.isInited()){let t;Ke("Initializing bot"),this.mePromise??=Xe((()=>this.api.getMe(e)),e);try{t=await this.mePromise}finally{this.mePromise=void 0}void 0===this.me?this.me=t:Ke("Bot info was set by now, will not overwrite")}Ke(`I am ${this.me.username}!`)}async handleUpdates(e){for(const t of e){this.lastTriedUpdateId=t.update_id;try{await this.handleUpdate(t)}catch(e){if(!(e instanceof E))throw console.error("FATAL: grammY unable to handle:",e),e;await this.errorHandler(e)}}}async handleUpdate(e,t){if(void 0===this.me)throw new Error("Bot not initialized! Either call `await bot.init()`, or directly set the `botInfo` option in the `Bot` constructor to specify a known bot info object.");Ke(`Processing update ${e.update_id}`);const i=new We(this.token,this.clientConfig,t),r=this.api.config.installedTransformers();r.length>0&&i.config.use(...r);const s=new this.ContextConstructor(e,i,this.me);try{await P(this.middleware(),s)}catch(t){throw He(`Error in middleware for update ${e.update_id}`),new E(t,s)}}async start(e){const t=[];if(this.isInited()||t.push(this.init(this.pollingAbortController?.signal)),this.pollingRunning)return await Promise.all(t),void Ke("Simple long polling already running!");this.pollingRunning=!0,this.pollingAbortController=new AbortController;try{t.push(Xe((async()=>{await this.api.deleteWebhook({drop_pending_updates:e?.drop_pending_updates},this.pollingAbortController?.signal)}),this.pollingAbortController?.signal)),await Promise.all(t),await(e?.onStart?.(this.botInfo))}catch(e){throw this.pollingRunning=!1,this.pollingAbortController=void 0,e}this.pollingRunning&&(!function(e,t=ze){const i=Array.from(e).filter((e=>!t.includes(e)));i.length>0&&Ye(`You registered listeners for the following update types, but you did not specify them in \`allowed_updates\` so they may not be received: ${i.map((e=>`'${e}'`)).join(", ")}`)}(this.observedUpdateTypes,e?.allowed_updates),this.use=et,Ke("Starting simple long polling"),await this.loop(e),Ke("Middleware is done running"))}async stop(){if(this.pollingRunning){Ke("Stopping bot, saving update offset"),this.pollingRunning=!1,this.pollingAbortController?.abort();const e=this.lastTriedUpdateId+1;await this.api.getUpdates({offset:e,limit:1}).finally((()=>this.pollingAbortController=void 0))}else Ke("Bot is not running!")}catch(e){this.errorHandler=e}async loop(e){const t=e?.limit,i=e?.timeout??30;let r=e?.allowed_updates??[];for(;this.pollingRunning;){const e=await this.fetchUpdates({limit:t,timeout:i,allowed_updates:r});if(void 0===e)break;await this.handleUpdates(e),r=void 0}}async fetchUpdates({limit:e,timeout:t,allowed_updates:i}){const r=this.lastTriedUpdateId+1;let s;do{try{s=await this.api.getUpdates({offset:r,limit:e,timeout:t,allowed_updates:i},this.pollingAbortController?.signal)}catch(e){await this.handlePollingError(e)}}while(void 0===s&&this.pollingRunning);return s}async handlePollingError(e){if(!this.pollingRunning)return void Ke("Pending getUpdates request cancelled");let t=3;if(e instanceof be){if(He(e.message),401===e.error_code||409===e.error_code)throw e;429===e.error_code&&(He("Bot API server is closing."),t=e.parameters.retry_after??t)}else He(e);He(`Call to getUpdates failed, retrying in ${t} seconds ...`),await Ze(t)}}(function(){const e=process.env.TOKEN;if(!e)throw new Error(ft);return e}());Tt.command("start",(async e=>{const t=(new it).text(ut.BREAKING_BAD,"breakingBad").text(ut.NOT_SHURE,"notShure");await e.reply(lt,{reply_markup:t})})),Tt.callbackQuery(["breakingBad","notShure"],(async e=>{const t=(new tt).text(vt).text(kt).row().text(It).text(Mt).resized();await e.reply(pt,{reply_markup:t})})),Tt.hears([vt,kt,It,Mt],(async e=>{const t=function(e){const t=Math.floor(Math.random()*bt[e].length);return bt[e][t]}(function(e){switch(!0){case e===dt.PROCESS:return"process";case e===dt.TECHICAL:return"technical";case e===dt.EXPERTISE:return"expertise";default:return"base"}}(e.message?.text??"base")??"base"),i=t.options.map((e=>[it.text(e.text,JSON.stringify({isCorrect:e.isCorrect}))])),r=it.from(i);await e.reply(t.text,{reply_markup:r})})),Tt.on("callback_query:data",(async e=>{JSON.parse(e.callbackQuery.data).isCorrect?await e.answerCallbackQuery({text:mt}):await e.answerCallbackQuery({text:gt,show_alert:!0})})),Tt.catch((e=>{const t=e.ctx;console.error(`${_t} ${t.update.update_id}:`);const i=e.error;i instanceof be?console.error(yt,i.description):i instanceof ve?console.error(Ct,i):console.error(wt,i)})),Tt.start();
//# sourceMappingURL=main.js.map
